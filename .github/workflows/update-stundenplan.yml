name: Update Stundenplan (Fixed)

on:
push:
paths:
- â€˜plan/*.pdfâ€™
workflow_dispatch:

jobs:
update-timetable:
runs-on: ubuntu-latest

```
steps:
  - name: Checkout repository
    uses: actions/checkout@v4

  - name: Setup Node.js
    uses: actions/setup-node@v4
    with:
      node-version: '20'

  - name: Install pdf-parse directly
    run: |
      echo "ğŸ“¦ Installing pdf-parse..."
      npm install pdf-parse
      echo "âœ… pdf-parse installed"

  - name: Check for PDF files
    run: |
      echo "ğŸ” Searching for PDF files in plan/..."
      ls -la plan/
      PDF_COUNT=$(find plan/ -name "*.pdf" -type f | wc -l)
      echo "Found $PDF_COUNT PDF file(s)"
      
      if [ $PDF_COUNT -eq 0 ]; then
        echo "âŒ No PDF found in /plan/"
        exit 1
      fi

  - name: Run Parser with Debug
    run: |
      echo "ğŸ“„ Finding PDF file..."
      PDF_FILE=$(find plan/ -name "*.pdf" -type f | head -n 1)
      echo "Found: $PDF_FILE"
      
      echo "ğŸ”„ Running parser..."
      echo "Parser: tools/pdf-parser-specialized.js"
      echo "Output: data/timetable.json"
      
      # Check if parser exists
      if [ ! -f "tools/pdf-parser-specialized.js" ]; then
        echo "âŒ Parser not found!"
        echo "Looking for parser files..."
        ls -la tools/
        exit 1
      fi
      
      # Run parser with error handling
      if node tools/pdf-parser-specialized.js "$PDF_FILE" --out data/timetable.json --validFrom $(date +%Y-%m-%d) 2>&1; then
        echo "âœ… Parser completed successfully"
      else
        echo "âŒ Parser failed!"
        echo "Trying alternative parser..."
        node tools/pdf-parser-v2.js "$PDF_FILE" --out data/timetable.json 2>&1 || true
      fi

  - name: Verify output
    run: |
      if [ -f "data/timetable.json" ]; then
        echo "âœ… timetable.json created"
        echo "File size: $(stat -f%z data/timetable.json 2>/dev/null || stat -c%s data/timetable.json) bytes"
        echo ""
        echo "First 20 lines:"
        head -20 data/timetable.json
      else
        echo "âŒ timetable.json was not created"
        exit 1
      fi

  - name: Commit changes
    run: |
      git config --local user.email "github-actions[bot]@users.noreply.github.com"
      git config --local user.name "github-actions[bot]"
      
      if git diff --quiet data/timetable.json; then
        echo "â„¹ï¸  No changes in timetable.json"
        exit 0
      fi
      
      git add data/timetable.json
      git commit -m "ğŸ”„ Auto-update: Stundenplan ($(date +%Y-%m-%d))"
      echo "âœ… Changes committed"

  - name: Push changes
    uses: ad-m/github-push-action@master
    with:
      github_token: ${{ secrets.GITHUB_TOKEN }}
      branch: ${{ github.ref }}
```